#!/bin/bash

set -euxo pipefail

STUDY="$(basename "$1" .pdf)"
if [ $(gpg --decrypt "$1.gpg" | md5) != $(md5 < "$1") ]; then
   gpg --yes --encrypt --recipient p@epij.nl "$1"
fi

STORE="fragments/$STUDY.yml"

touch "$STORE"

TMP=$(gmktemp --suffix .org)
python extract.py "$STORE" < "$1" > $TMP
$EDITOR $TMP
python save.py < $TMP > "$STORE"
