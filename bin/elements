#!/bin/bash

set -euxo pipefail

STUDY="$(basename "$1" .pdf)"
FRAGMENTS="fragments/$STUDY.yml"
ELEMENTS="elements/$STUDY.yml"

touch $ELEMENTS

TMP="$(gmktemp -t "$STUDY (tmp-XXX).org")"
python extract2.py "$FRAGMENTS" < "$1" \
    | python summarize2.py "$ELEMENTS" > "$TMP"

$EDITOR "$TMP"

python save_elements.py < "$TMP" > "$ELEMENTS"
