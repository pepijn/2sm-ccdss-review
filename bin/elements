#!/bin/bash

set -euxo pipefail

STUDY="$(basename "$1" .pdf)"
gpg --yes --encrypt --recipient p@epij.nl "$1"

FRAGMENTS="fragments/$STUDY.yml"
ELEMENTS="elements/$STUDY.yml"

touch "$ELEMENTS"

TMP="$(gmktemp -t "$STUDY (tmp-XXX).org")"
python extract.py "$FRAGMENTS" < "$1" \
    | python summarize.py "$ELEMENTS" > "$TMP"

$EDITOR "$TMP"

python save_elements.py < "$TMP" > "$ELEMENTS"
